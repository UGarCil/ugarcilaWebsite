<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Crimson+Text:wght@300&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" text="text/css" href="../styles.css">
    <meta charset="UTF-8">

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V9043QSBQP"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-V9043QSBQP');
    </script>
    <title>4_Wave Function Collapse</title>
</head>

<body>
    <!-- Navbar -->
    <div>
        <nav class="navbar navbar-expand-md navbar-dark colorize pt-1 pt-2">
            <a class="navbar-brand img-fluid" href="./index.html">
                <img src="./Images/HomeIcon.png" style="width: 120px; padding: 1.2rem;" alt="">
            </a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse justify-content-sm-end" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <!-- <a class="nav-link" href="#">About <span class="sr-only">(current)</span></a> -->
                        <a class="nav-link nav--text" href="./WedDesign.html" style="color: white;">Web design</a>
                    </li>
                    <li class="nav-item">
                        <!-- <a class="nav-link" href="#">About <span class="sr-only">(current)</span></a> -->
                        <a class="nav-link nav--text" href="./portfolio.html" style="color: white;">Portfolio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav--text" href="./outreach.html" style="color: white;">Outreach</a>
                    </li>
                    <!-- A special type of dropdown item -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="./teaching.html" style="color: white;"
                            id="navbarDropdown" role="button" data-toggle="dropdown">
                            Teaching
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="teachingUBC.html"
                                style="color: white; background-color: rgb(12, 12, 11);" target="_blank">Genetics at
                                UBC</a>
                            <div class="dropdown-divider" style="background-color: white; height: 2px;"></div>
                            <a class="dropdown-item" href="teachingCode.html" style="color: white;"
                                target="_blank">Coding for kids</a>
                            <a class="dropdown-item" href="teachingSTEM.html" style="color: white;" target="_blank">STEM
                                for kids</a>

                    <li class="nav-item">
                        <a class="nav-link nav--text" href="./microptics.html" style="color: white;">Microptics</a>
                    </li>
                </ul>
            </div>
        </nav>
    </div>

    <div class="container-fluid p-3 pb-0 pt-0">


        <div class="mainCenterTxt--black p-4">
            <h2>Polar Coordinates</h2>
            The Wave Function Collapse (WFC) algorithm is a powerful technique used in procedural generation within the
            fields of programming and computer science. It's particularly popular for generating complex and realistic
            patterns, textures, and even entire game levels. The algorithm is based on principles from quantum mechanics
            and is used to create output that exhibits certain characteristics based on input data or constraints.


            <br><br>


            <hr>
            <div>
                You can find the tilesets used in this tutorial <a href="../ResourcesTutorials/TilesWFC.zip">here</a>
            </div>

            <div>
                <h2>The parameters of the Algorithm</h2>
                <ul>
                    <li><strong>RES:</strong> (int,int) - The size of each tile</li>
                    <li><strong>DIMS:</strong> (int,int) - Total number of columns and rows that compose the grid</li>
                    <li><strong>SCREEN:</strong> (int,int) - The width and height of the screen given in pixels</li>
                    <li><strong>METADATA:</strong> [Dict, ...] - A collection of compound datatype representing the
                        identity of the tiles available, based on their "sockets"</li>
                    <li><strong>TILE:</strong> Tile() - Basic Unit of information in the WFC algorithm</li>
                    <li><strong>GRID:</strong> [[TILE, ..., n=DIMS[0]], ..., n=DIMS[1]] - a 2D array of TILE</li>
                </ul>
            </div>

            <div>
                <!-- HTML generated using hilite.me -->
                <!-- HTML generated using hilite.me -->
                <div
                    style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                    <pre style="margin: 0; line-height: 125%"><span style="color: #888888"># MODULES</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">pygame</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">random</span>

<span style="color: #888888"># DD</span>
RES <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">16</span>
DIMS <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">60</span>, <span style="color: #0000DD; font-weight: bold">40</span>)
SCREEN <span style="color: #333333">=</span> (DIMS[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">*</span>RES, DIMS[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">*</span>RES)
display <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>set_mode(SCREEN)
TILES <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;tiles2&quot;</span>
PATH <span style="color: #333333">=</span> f<span style="background-color: #fff0f0">&quot;./{TILES}/res_{RES}/&quot;</span>
PATH_METADATA <span style="color: #333333">=</span> f<span style="background-color: #fff0f0">&quot;./{TILES}/metadata.txt&quot;</span>


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">rotateSockets</span>(sockets, angle):
    <span style="color: #008800; font-weight: bold">return</span> [sockets[i<span style="color: #333333">-</span>angle] <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">4</span>)]


<span style="color: #888888"># DD. METADATA</span>
<span style="color: #888888"># metadata = [Dict, ...]</span>
<span style="color: #888888"># interp. a collection of metadata for the tiles that can be used in the WFC</span>
metadata <span style="color: #333333">=</span> []
<span style="color: #008800; font-weight: bold">with</span> <span style="color: #007020">open</span>(PATH_METADATA, <span style="background-color: #fff0f0">&quot;r&quot;</span>) <span style="color: #008800; font-weight: bold">as</span> <span style="color: #007020">file</span>:
    <span style="color: #007020">file</span> <span style="color: #333333">=</span> <span style="color: #007020">file</span><span style="color: #333333">.</span>readlines()
    <span style="color: #008800; font-weight: bold">for</span> line <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">file</span>:
        line <span style="color: #333333">=</span> line<span style="color: #333333">.</span>strip()<span style="color: #333333">.</span>split(<span style="background-color: #fff0f0">&quot;</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\t</span><span style="background-color: #fff0f0">&quot;</span>)
        <span style="color: #008800; font-weight: bold">if</span> line[<span style="color: #0000DD; font-weight: bold">5</span>] <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;1&quot;</span>:
            metaEntry <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;ID&quot;</span>: line[<span style="color: #0000DD; font-weight: bold">0</span>], <span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>: [
                line[<span style="color: #0000DD; font-weight: bold">1</span>], line[<span style="color: #0000DD; font-weight: bold">2</span>], line[<span style="color: #0000DD; font-weight: bold">3</span>], line[<span style="color: #0000DD; font-weight: bold">4</span>]], <span style="background-color: #fff0f0">&quot;FIXED&quot;</span>: <span style="color: #007020">True</span>, <span style="background-color: #fff0f0">&quot;ROTATION&quot;</span>: <span style="color: #0000DD; font-weight: bold">0</span>}
            metadata<span style="color: #333333">.</span>append(metaEntry)
        <span style="color: #008800; font-weight: bold">else</span>:
            <span style="color: #008800; font-weight: bold">for</span> a <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">4</span>):
                metaEntry <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;ID&quot;</span>: line[<span style="color: #0000DD; font-weight: bold">0</span>], <span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>: rotateSockets(
                    [line[<span style="color: #0000DD; font-weight: bold">1</span>], line[<span style="color: #0000DD; font-weight: bold">2</span>], line[<span style="color: #0000DD; font-weight: bold">3</span>], line[<span style="color: #0000DD; font-weight: bold">4</span>]], a), <span style="background-color: #fff0f0">&quot;FIXED&quot;</span>: <span style="color: #007020">False</span>, <span style="background-color: #fff0f0">&quot;ROTATION&quot;</span>: a}
                metadata<span style="color: #333333">.</span>append(metaEntry)


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">socketMatch</span>(socket, targetsocket):
    <span style="color: #008800; font-weight: bold">for</span> idx_letter, _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(socket):
        <span style="color: #008800; font-weight: bold">if</span> socket[idx_letter] <span style="color: #333333">!=</span> targetsocket[<span style="color: #333333">-</span>(idx_letter<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)]:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>
    <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>

<span style="color: #888888"># DD. TILE</span>
<span style="color: #888888"># tile = Tile()</span>
<span style="color: #888888"># interp. a tile for the animation of WFC in a 2D grid</span>


<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Tile</span>:
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, c, r):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>c <span style="color: #333333">=</span> c
        <span style="color: #007020">self</span><span style="color: #333333">.</span>r <span style="color: #333333">=</span> r
        <span style="color: #007020">self</span><span style="color: #333333">.</span>x <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>c <span style="color: #333333">*</span> RES
        <span style="color: #007020">self</span><span style="color: #333333">.</span>y <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>r <span style="color: #333333">*</span> RES
        <span style="color: #007020">self</span><span style="color: #333333">.</span>img <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>image<span style="color: #333333">.</span>load(PATH <span style="color: #333333">+</span> f<span style="background-color: #fff0f0">&quot;{metadata[-1][&#39;ID&#39;]}.png&quot;</span>)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>rect <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>img<span style="color: #333333">.</span>get_rect()
        <span style="color: #007020">self</span><span style="color: #333333">.</span>rect<span style="color: #333333">.</span>topleft <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>x, <span style="color: #007020">self</span><span style="color: #333333">.</span>y
        <span style="color: #888888"># attr. related to WFC</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">=</span> <span style="color: #007020">len</span>(metadata)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles <span style="color: #333333">=</span> <span style="color: #007020">list</span>(metadata)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>collapsed <span style="color: #333333">=</span> <span style="color: #007020">False</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>sockets <span style="color: #333333">=</span> [<span style="background-color: #fff0f0">&quot;&quot;</span> <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">4</span>)]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">draw</span>(<span style="color: #007020">self</span>):
        display<span style="color: #333333">.</span>blit(<span style="color: #007020">self</span><span style="color: #333333">.</span>img, <span style="color: #007020">self</span><span style="color: #333333">.</span>rect)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">updateEntropy</span>(<span style="color: #007020">self</span>, lowestEntropy):
        placeHolderTileSet <span style="color: #333333">=</span> []
        <span style="color: #008800; font-weight: bold">for</span> potTile <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles:
            validTile <span style="color: #333333">=</span> <span style="color: #007020">True</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">0</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">1</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">2</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">3</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>

            <span style="color: #008800; font-weight: bold">if</span> validTile:
                placeHolderTileSet<span style="color: #333333">.</span>append(potTile)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles <span style="color: #333333">=</span> placeHolderTileSet

        seenTile <span style="color: #333333">=</span> []
        <span style="color: #008800; font-weight: bold">for</span> tile <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles:
            <span style="color: #008800; font-weight: bold">if</span> tile[<span style="background-color: #fff0f0">&quot;ID&quot;</span>] <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> seenTile:
                seenTile<span style="color: #333333">.</span>append(tile[<span style="background-color: #fff0f0">&quot;ID&quot;</span>])
        <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">=</span> <span style="color: #007020">len</span>(seenTile)
        <span style="color: #008800; font-weight: bold">if</span> lowestEntropy <span style="color: #333333">==</span> <span style="color: #007020">None</span> <span style="color: #000000; font-weight: bold">or</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">&lt;</span> lowestEntropy:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy
        <span style="color: #008800; font-weight: bold">return</span> lowestEntropy

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">updateNeighbors</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>collapsed:
            c <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>c
            r <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>r

            <span style="color: #008800; font-weight: bold">if</span> c <span style="color: #333333">&lt;</span> DIMS[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r][c<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r][c<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">2</span>]}
            <span style="color: #008800; font-weight: bold">if</span> r <span style="color: #333333">&lt;</span> DIMS[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">3</span>]}
            <span style="color: #008800; font-weight: bold">if</span> c <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r][c<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r][c<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">0</span>]}
            <span style="color: #008800; font-weight: bold">if</span> r <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">1</span>]}

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">collapse</span>(<span style="color: #007020">self</span>):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>collapsed <span style="color: #333333">=</span> <span style="color: #007020">True</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(<span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles) <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            potTile <span style="color: #333333">=</span> random<span style="color: #333333">.</span>choice(<span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles)
        <span style="color: #008800; font-weight: bold">else</span>:
            potTile <span style="color: #333333">=</span> metadata[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>name <span style="color: #333333">=</span> potTile[<span style="background-color: #fff0f0">&quot;ID&quot;</span>]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>img <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>image<span style="color: #333333">.</span>load(f<span style="background-color: #fff0f0">&quot;{PATH}/{self.name}.png&quot;</span>)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>sockets <span style="color: #333333">=</span> potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>img <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>transform<span style="color: #333333">.</span>rotate(<span style="color: #007020">self</span><span style="color: #333333">.</span>img, <span style="color: #333333">-</span>potTile[<span style="background-color: #fff0f0">&quot;ROTATION&quot;</span>] <span style="color: #333333">*</span> <span style="color: #0000DD; font-weight: bold">90</span>)


<span style="color: #888888"># DD. GRID</span>
<span style="color: #888888"># grid = [[TILE, ..., n=DIMS[0]], ..., n=DIMS[1]]</span>
<span style="color: #888888"># interp. 2D array of TILE</span>
grid <span style="color: #333333">=</span> []
<span style="color: #008800; font-weight: bold">for</span> r <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(DIMS[<span style="color: #0000DD; font-weight: bold">1</span>]):
    row <span style="color: #333333">=</span> []
    <span style="color: #008800; font-weight: bold">for</span> c <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(DIMS[<span style="color: #0000DD; font-weight: bold">0</span>]):
        tile <span style="color: #333333">=</span> Tile(c, r)
        row<span style="color: #333333">.</span>append(tile)
    grid<span style="color: #333333">.</span>append(row)

<span style="color: #888888"># TEMPLATE FOR GRID</span>
<span style="color: #888888"># for row in grid:</span>
<span style="color: #888888">#   ... row</span>
<span style="color: #888888">#   for tile in row:</span>
<span style="color: #888888">#       ... tile</span>
</pre>
                </div>




            </div>

            <div>
                <h2>The Algorithm</h2>
                <ul>
                    <li>WHILE there is at least one TILE in GRID with entropy > 0</li>
                    <li>For each TILE in GRID:</li>
                    <li>
                        <ul>
                            <li>update sockets by evaluating which neighbors are collapsed</li>
                            <li>update entropy and the number of potential identities that TILE can take out of METADATA
                            </li>
                        </ul>
                    </li>
                    <li>Calculate the smallest entropy value in the system to get LOWESTENTROPY</li>
                    <li>Make list of candidate TILE, which entropies are equal to LOWESTENTROPY</li>
                    <li>Pick one of the candidates at random, and collapse it</li>
                </ul>

            </div>





            </p>





        </div>
        <div style="text-align: center; margin-top: 2em;">
            Introduction: How does this algorithm work
        </div>
        <div style="text-align: center; margin-top: 2em;">
            <iframe width="560" height="315" src="https://www.youtube.com/embed/ZdbpTkuStKI?si=ULlrVdeCOcQquq69"
                title="YouTube video player" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen></iframe>
        </div>

        <div style="text-align: center; margin-top: 2em;">
            Part 1: Data definitions and creating a TILE
        </div>
        <div style="text-align: center; margin-top: 2em;">
            <iframe style="text-align: center; margin-top: 2em;" width="560" height="315"
                src="https://www.youtube.com/embed/Wx6PNRksIdw?si=akCBF8bWnHKoYAgz" title="YouTube video player"
                frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen></iframe>
        </div>

        <div style="text-align: center; margin-top: 2em;">
            Part 2: Traversing the GRID and applying the algorithm
        </div>
        <div style="text-align: center; margin-top: 2em;">
            <iframe width="560" height="315" src="https://www.youtube.com/embed/-t8DxrNwCVE?si=IQL1zX1eGuDPjbM8"
                title="YouTube video player" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen></iframe>
        </div>

        <div class="container-fluid p-3 pb-0 pt-0">

            <!-- HTML generated using hilite.me -->
            <!-- HTML generated using hilite.me -->
            <!-- HTML generated using hilite.me -->
            <div
                style="background: #ffffff; overflow:auto;width:auto;border:solid gray;border-width:.1em .1em .1em .8em;padding:.2em .6em;">
                <pre style="margin: 0; line-height: 125%"><span style="color: #888888"># MODULES</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">pygame</span>
<span style="color: #008800; font-weight: bold">import</span> <span style="color: #0e84b5; font-weight: bold">random</span>

<span style="color: #888888"># DD</span>
RES <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">16</span>
DIMS <span style="color: #333333">=</span> (<span style="color: #0000DD; font-weight: bold">60</span>, <span style="color: #0000DD; font-weight: bold">40</span>)
SCREEN <span style="color: #333333">=</span> (DIMS[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">*</span>RES, DIMS[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">*</span>RES)
display <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>set_mode(SCREEN)
TILES <span style="color: #333333">=</span> <span style="background-color: #fff0f0">&quot;tiles2&quot;</span>
PATH <span style="color: #333333">=</span> f<span style="background-color: #fff0f0">&quot;./{TILES}/res_{RES}/&quot;</span>
PATH_METADATA <span style="color: #333333">=</span> f<span style="background-color: #fff0f0">&quot;./{TILES}/metadata.txt&quot;</span>


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">rotateSockets</span>(sockets, angle):
    <span style="color: #008800; font-weight: bold">return</span> [sockets[i<span style="color: #333333">-</span>angle] <span style="color: #008800; font-weight: bold">for</span> i <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">4</span>)]


<span style="color: #888888"># DD. METADATA</span>
<span style="color: #888888"># metadata = [Dict, ...]</span>
<span style="color: #888888"># interp. a collection of metadata for the tiles that can be used in the WFC</span>
metadata <span style="color: #333333">=</span> []
<span style="color: #008800; font-weight: bold">with</span> <span style="color: #007020">open</span>(PATH_METADATA, <span style="background-color: #fff0f0">&quot;r&quot;</span>) <span style="color: #008800; font-weight: bold">as</span> <span style="color: #007020">file</span>:
    <span style="color: #007020">file</span> <span style="color: #333333">=</span> <span style="color: #007020">file</span><span style="color: #333333">.</span>readlines()
    <span style="color: #008800; font-weight: bold">for</span> line <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">file</span>:
        line <span style="color: #333333">=</span> line<span style="color: #333333">.</span>strip()<span style="color: #333333">.</span>split(<span style="background-color: #fff0f0">&quot;</span><span style="color: #666666; font-weight: bold; background-color: #fff0f0">\t</span><span style="background-color: #fff0f0">&quot;</span>)
        <span style="color: #008800; font-weight: bold">if</span> line[<span style="color: #0000DD; font-weight: bold">5</span>] <span style="color: #333333">==</span> <span style="background-color: #fff0f0">&quot;1&quot;</span>:
            metaEntry <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;ID&quot;</span>: line[<span style="color: #0000DD; font-weight: bold">0</span>], <span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>: [
                line[<span style="color: #0000DD; font-weight: bold">1</span>], line[<span style="color: #0000DD; font-weight: bold">2</span>], line[<span style="color: #0000DD; font-weight: bold">3</span>], line[<span style="color: #0000DD; font-weight: bold">4</span>]], <span style="background-color: #fff0f0">&quot;FIXED&quot;</span>: <span style="color: #007020">True</span>, <span style="background-color: #fff0f0">&quot;ROTATION&quot;</span>: <span style="color: #0000DD; font-weight: bold">0</span>}
            metadata<span style="color: #333333">.</span>append(metaEntry)
        <span style="color: #008800; font-weight: bold">else</span>:
            <span style="color: #008800; font-weight: bold">for</span> a <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">4</span>):
                metaEntry <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;ID&quot;</span>: line[<span style="color: #0000DD; font-weight: bold">0</span>], <span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>: rotateSockets(
                    [line[<span style="color: #0000DD; font-weight: bold">1</span>], line[<span style="color: #0000DD; font-weight: bold">2</span>], line[<span style="color: #0000DD; font-weight: bold">3</span>], line[<span style="color: #0000DD; font-weight: bold">4</span>]], a), <span style="background-color: #fff0f0">&quot;FIXED&quot;</span>: <span style="color: #007020">False</span>, <span style="background-color: #fff0f0">&quot;ROTATION&quot;</span>: a}
                metadata<span style="color: #333333">.</span>append(metaEntry)


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">socketMatch</span>(socket, targetsocket):
    <span style="color: #008800; font-weight: bold">for</span> idx_letter, _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">enumerate</span>(socket):
        <span style="color: #008800; font-weight: bold">if</span> socket[idx_letter] <span style="color: #333333">!=</span> targetsocket[<span style="color: #333333">-</span>(idx_letter<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>)]:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">False</span>
    <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">True</span>

<span style="color: #888888"># DD. TILE</span>
<span style="color: #888888"># tile = Tile()</span>
<span style="color: #888888"># interp. a tile for the animation of WFC in a 2D grid</span>


<span style="color: #008800; font-weight: bold">class</span> <span style="color: #BB0066; font-weight: bold">Tile</span>:
    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">__init__</span>(<span style="color: #007020">self</span>, c, r):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>c <span style="color: #333333">=</span> c
        <span style="color: #007020">self</span><span style="color: #333333">.</span>r <span style="color: #333333">=</span> r
        <span style="color: #007020">self</span><span style="color: #333333">.</span>x <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>c <span style="color: #333333">*</span> RES
        <span style="color: #007020">self</span><span style="color: #333333">.</span>y <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>r <span style="color: #333333">*</span> RES
        <span style="color: #007020">self</span><span style="color: #333333">.</span>img <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>image<span style="color: #333333">.</span>load(PATH <span style="color: #333333">+</span> f<span style="background-color: #fff0f0">&quot;{metadata[-1][&#39;ID&#39;]}.png&quot;</span>)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>rect <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>img<span style="color: #333333">.</span>get_rect()
        <span style="color: #007020">self</span><span style="color: #333333">.</span>rect<span style="color: #333333">.</span>topleft <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>x, <span style="color: #007020">self</span><span style="color: #333333">.</span>y
        <span style="color: #888888"># attr. related to WFC</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">=</span> <span style="color: #007020">len</span>(metadata)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles <span style="color: #333333">=</span> <span style="color: #007020">list</span>(metadata)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>collapsed <span style="color: #333333">=</span> <span style="color: #007020">False</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>sockets <span style="color: #333333">=</span> [<span style="background-color: #fff0f0">&quot;&quot;</span> <span style="color: #008800; font-weight: bold">for</span> _ <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(<span style="color: #0000DD; font-weight: bold">4</span>)]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}
        <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh <span style="color: #333333">=</span> {<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: <span style="color: #007020">None</span>, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: <span style="color: #007020">None</span>}

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">draw</span>(<span style="color: #007020">self</span>):
        display<span style="color: #333333">.</span>blit(<span style="color: #007020">self</span><span style="color: #333333">.</span>img, <span style="color: #007020">self</span><span style="color: #333333">.</span>rect)

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">updateEntropy</span>(<span style="color: #007020">self</span>, lowestEntropy):
        placeHolderTileSet <span style="color: #333333">=</span> []
        <span style="color: #008800; font-weight: bold">for</span> potTile <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles:
            validTile <span style="color: #333333">=</span> <span style="color: #007020">True</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">0</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">1</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">2</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh[<span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>] <span style="color: #000000; font-weight: bold">and</span> <span style="color: #000000; font-weight: bold">not</span> socketMatch(potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>][<span style="color: #0000DD; font-weight: bold">3</span>], <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh[<span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>]):
                validTile <span style="color: #333333">=</span> <span style="color: #007020">False</span>

            <span style="color: #008800; font-weight: bold">if</span> validTile:
                placeHolderTileSet<span style="color: #333333">.</span>append(potTile)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles <span style="color: #333333">=</span> placeHolderTileSet

        seenTile <span style="color: #333333">=</span> []
        <span style="color: #008800; font-weight: bold">for</span> tile <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles:
            <span style="color: #008800; font-weight: bold">if</span> tile[<span style="background-color: #fff0f0">&quot;ID&quot;</span>] <span style="color: #000000; font-weight: bold">not</span> <span style="color: #000000; font-weight: bold">in</span> seenTile:
                seenTile<span style="color: #333333">.</span>append(tile[<span style="background-color: #fff0f0">&quot;ID&quot;</span>])
        <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">=</span> <span style="color: #007020">len</span>(seenTile)
        <span style="color: #008800; font-weight: bold">if</span> lowestEntropy <span style="color: #333333">==</span> <span style="color: #007020">None</span> <span style="color: #000000; font-weight: bold">or</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">&lt;</span> lowestEntropy:
            <span style="color: #008800; font-weight: bold">return</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy
        <span style="color: #008800; font-weight: bold">return</span> lowestEntropy

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">updateNeighbors</span>(<span style="color: #007020">self</span>):
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>collapsed:
            c <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>c
            r <span style="color: #333333">=</span> <span style="color: #007020">self</span><span style="color: #333333">.</span>r

            <span style="color: #008800; font-weight: bold">if</span> c <span style="color: #333333">&lt;</span> DIMS[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>RIGHT_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r][c<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r][c<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">2</span>]}
            <span style="color: #008800; font-weight: bold">if</span> r <span style="color: #333333">&lt;</span> DIMS[<span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>DOWN_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r<span style="color: #333333">+</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">3</span>]}
            <span style="color: #008800; font-weight: bold">if</span> c <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>LEFT_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r][c<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r][c<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">0</span>]}
            <span style="color: #008800; font-weight: bold">if</span> r <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
                <span style="color: #007020">self</span><span style="color: #333333">.</span>UP_neigh <span style="color: #333333">=</span> {
                    <span style="background-color: #fff0f0">&quot;COLLAPSED&quot;</span>: grid[r<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>collapsed, <span style="background-color: #fff0f0">&quot;SOCKET&quot;</span>: grid[r<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>][c]<span style="color: #333333">.</span>sockets[<span style="color: #0000DD; font-weight: bold">1</span>]}

    <span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">collapse</span>(<span style="color: #007020">self</span>):
        <span style="color: #007020">self</span><span style="color: #333333">.</span>collapsed <span style="color: #333333">=</span> <span style="color: #007020">True</span>
        <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(<span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles) <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
            potTile <span style="color: #333333">=</span> random<span style="color: #333333">.</span>choice(<span style="color: #007020">self</span><span style="color: #333333">.</span>potentialTiles)
        <span style="color: #008800; font-weight: bold">else</span>:
            potTile <span style="color: #333333">=</span> metadata[<span style="color: #333333">-</span><span style="color: #0000DD; font-weight: bold">1</span>]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>name <span style="color: #333333">=</span> potTile[<span style="background-color: #fff0f0">&quot;ID&quot;</span>]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>img <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>image<span style="color: #333333">.</span>load(f<span style="background-color: #fff0f0">&quot;{PATH}/{self.name}.png&quot;</span>)
        <span style="color: #007020">self</span><span style="color: #333333">.</span>sockets <span style="color: #333333">=</span> potTile[<span style="background-color: #fff0f0">&quot;SOCKETS&quot;</span>]
        <span style="color: #007020">self</span><span style="color: #333333">.</span>entropy <span style="color: #333333">=</span> <span style="color: #0000DD; font-weight: bold">0</span>
        <span style="color: #007020">self</span><span style="color: #333333">.</span>img <span style="color: #333333">=</span> pygame<span style="color: #333333">.</span>transform<span style="color: #333333">.</span>rotate(<span style="color: #007020">self</span><span style="color: #333333">.</span>img, <span style="color: #333333">-</span>potTile[<span style="background-color: #fff0f0">&quot;ROTATION&quot;</span>] <span style="color: #333333">*</span> <span style="color: #0000DD; font-weight: bold">90</span>)


<span style="color: #888888"># DD. GRID</span>
<span style="color: #888888"># grid = [[TILE, ..., n=DIMS[0]], ..., n=DIMS[1]]</span>
<span style="color: #888888"># interp. 2D array of TILE</span>
grid <span style="color: #333333">=</span> []
<span style="color: #008800; font-weight: bold">for</span> r <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(DIMS[<span style="color: #0000DD; font-weight: bold">1</span>]):
    row <span style="color: #333333">=</span> []
    <span style="color: #008800; font-weight: bold">for</span> c <span style="color: #000000; font-weight: bold">in</span> <span style="color: #007020">range</span>(DIMS[<span style="color: #0000DD; font-weight: bold">0</span>]):
        tile <span style="color: #333333">=</span> Tile(c, r)
        row<span style="color: #333333">.</span>append(tile)
    grid<span style="color: #333333">.</span>append(row)

<span style="color: #888888"># TEMPLATE FOR GRID</span>
<span style="color: #888888"># for row in grid:</span>
<span style="color: #888888">#   ... row</span>
<span style="color: #888888">#   for tile in row:</span>
<span style="color: #888888">#       ... tile</span>

<span style="color: #888888"># CODE</span>

grid[<span style="color: #0000DD; font-weight: bold">0</span>][<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">.</span>collapse()


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">draw</span>():
    display<span style="color: #333333">.</span>fill(<span style="background-color: #fff0f0">&quot;#1e1e1e&quot;</span>)
    <span style="color: #008800; font-weight: bold">for</span> row <span style="color: #000000; font-weight: bold">in</span> grid:
        <span style="color: #008800; font-weight: bold">for</span> tile <span style="color: #000000; font-weight: bold">in</span> row:
            tile<span style="color: #333333">.</span>draw()
    pygame<span style="color: #333333">.</span>display<span style="color: #333333">.</span>flip()


<span style="color: #008800; font-weight: bold">def</span> <span style="color: #0066BB; font-weight: bold">update</span>():
    <span style="color: #008800; font-weight: bold">for</span> event <span style="color: #000000; font-weight: bold">in</span> pygame<span style="color: #333333">.</span>event<span style="color: #333333">.</span>get():
        <span style="color: #008800; font-weight: bold">if</span> event<span style="color: #333333">.</span>type <span style="color: #333333">==</span> pygame<span style="color: #333333">.</span>QUIT:
            pygame<span style="color: #333333">.</span>quit()


    <span style="color: #008800; font-weight: bold">for</span> row <span style="color: #000000; font-weight: bold">in</span> grid:
        <span style="color: #008800; font-weight: bold">for</span> tile <span style="color: #000000; font-weight: bold">in</span> row:
            tile<span style="color: #333333">.</span>updateNeighbors()

    lowestEntropy <span style="color: #333333">=</span> <span style="color: #007020">None</span>
    <span style="color: #008800; font-weight: bold">for</span> row <span style="color: #000000; font-weight: bold">in</span> grid:
        <span style="color: #008800; font-weight: bold">for</span> tile <span style="color: #000000; font-weight: bold">in</span> row:
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> tile<span style="color: #333333">.</span>collapsed:
                lowestEntropy <span style="color: #333333">=</span> tile<span style="color: #333333">.</span>updateEntropy(lowestEntropy)

    candidates <span style="color: #333333">=</span> []
    <span style="color: #008800; font-weight: bold">for</span> row <span style="color: #000000; font-weight: bold">in</span> grid:
        <span style="color: #008800; font-weight: bold">for</span> tile <span style="color: #000000; font-weight: bold">in</span> row:
            <span style="color: #008800; font-weight: bold">if</span> <span style="color: #000000; font-weight: bold">not</span> tile<span style="color: #333333">.</span>collapsed <span style="color: #000000; font-weight: bold">and</span> tile<span style="color: #333333">.</span>entropy <span style="color: #333333">==</span> lowestEntropy:
                candidates<span style="color: #333333">.</span>append(tile)

    <span style="color: #008800; font-weight: bold">if</span> <span style="color: #007020">len</span>(candidates) <span style="color: #333333">&gt;</span> <span style="color: #0000DD; font-weight: bold">0</span>:
        candidates[<span style="color: #0000DD; font-weight: bold">0</span>]<span style="color: #333333">.</span>collapse()

<span style="color: #008800; font-weight: bold">while</span> <span style="color: #007020">True</span>:
    draw()
    update()
</pre>
            </div>















        </div>

</body>